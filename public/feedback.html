<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Feedback</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 50px;
        }
        .feedback-container {
            max-width: 400px;
            margin: auto;
        }
        select, textarea, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="feedback-container">
        <h1>Submit Feedback</h1>
        <form id="feedbackForm">
            <!-- Teacher Selection Dropdown -->
            <select id="teacherSelect" required>
                <option value="">Select Teacher</option>
            </select>

            <!-- Rating Questions -->
            <label for="q1">Question 1:</label>
            <select id="q1" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>

            <label for="q2">Question 2:</label>
            <select id="q2" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>

            <!-- Add more questions up to Q10 -->
            <label for="q3">Question 3:</label>
            <select id="q3" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>

            <label for="q4">Question 4:</label>
            <select id="q4" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>

            <label for="q5">Question 5:</label>
            <select id="q5" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>

            <label for="q6">Question 6:</label>
            <select id="q6" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>

            <label for="q7">Question 7:</label>
            <select id="q7" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>

            <label for="q8">Question 8:</label>
            <select id="q8" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>

            <label for="q9">Question 9:</label>
            <select id="q9" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>

            <label for="q10">Question 10:</label>
            <select id="q10" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>

            <!-- Feedback Textarea -->
            <textarea id="feedbackText" placeholder="Enter your feedback" required></textarea>

            <!-- Submit Button -->
            <button type="submit">Submit Feedback</button>
        </form>
    </div>

    <script>
        // Fetch teachers and populate the dropdown on page load
        window.onload = async function() {
            try {
                const response = await fetch('/teachers');
                if (!response.ok) {
                    throw new Error('Failed to fetch teachers');
                }

                const teachers = await response.json();
                const teacherSelect = document.getElementById('teacherSelect');
                teacherSelect.innerHTML = '<option value="">Select Teacher</option>';

                if (teachers.length > 0) {
                    teachers.forEach(teacher => {
                        const option = document.createElement('option');
                        option.value = teacher.id;
                        option.textContent = `${teacher.name} (${teacher.subject})`;
                        teacherSelect.appendChild(option);
                    });
                } else {
                    console.warn('No teachers found');
                }
            } catch (error) {
                console.error('Error fetching teachers:', error);
            }
        };

        document.getElementById('feedbackForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const teacher_id = document.getElementById('teacherSelect').value;
    const feedback_text = document.getElementById('feedbackText').value;

    // Replace with actual ratings inputs
    const ratings = {
        q1: document.getElementById('q1').value,
        q2: document.getElementById('q2').value,
        q3: document.getElementById('q3').value,
        q4: document.getElementById('q4').value,
        q5: document.getElementById('q5').value,
        q6: document.getElementById('q6').value,
        q7: document.getElementById('q7').value,
        q8: document.getElementById('q8').value,
        q9: document.getElementById('q9').value,
        q10: document.getElementById('q10').value,
    };

    if (!teacher_id || !feedback_text) {
        alert('Please select a teacher and provide feedback.');
        return;
    }

    try {
        const response = await fetch('/submit-feedback', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ teacher_id, feedback_text, ratings, student_id: 1 }) // Hardcoded student_id
        });

        if (response.ok) {
            alert('Feedback submitted successfully');
            document.getElementById('feedbackForm').reset();
        } else {
            alert('Failed to submit feedback');
        }
    } catch (error) {
        console.error('Error submitting feedback:', error);
        alert('Error submitting feedback');
    }
});

    </script>
</body>
</html>
